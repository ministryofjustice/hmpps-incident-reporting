{% extends "../../partials/layout.njk" %}

{% from "govuk/components/table/macro.njk" import govukTable %}

{% set pageTitle = applicationName + " - Home" %}
{% set mainClasses = "govuk-body" %}

{% block content %}
  {% set rows = [] %}
  {% for inc in incidents %}
    {% set title %}{{ inc.title }}{% endset %}
    {% set rows = (rows.push(
      [
        { html: "<a href='/incident/" + inc.id + "/'>" + title + "</a>" },
        { text: inc.description },
        { text: usersLookup[inc.modifiedBy].name or inc.modifiedBy },
        { text: inc.modifiedAt | dateAndTime },
        { text: inc.reports.length }
      ]
    ), rows) %}
  {% endfor %}

  <div>
  {{ govukTable({
    caption: "Incident events",
    captionClasses: "govuk-table__caption--l",
    firstCellIsHeader: true,
    head: [
      {
        text: "Title"
      },
      {
        text: "Description"
      },
      {
        text: "Modified By"
      },
      {
        text: "Modified At"
      },
      {
        text: "Number of reports"
      }
    ],
    rows: rows
  }) }}
  </div>

{% endblock %}
